<!DOCTYPE html><html domain="dushkin.tech" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><link href="/img/favicon/apple-touch-icon.png?hash=4886ee33b3" rel="apple-touch-icon" sizes="180x180"><link href="/img/favicon/favicon-32x32.png?hash=44c2abca90" rel="icon" type="image/png" sizes="32x32"><link href="/img/favicon/favicon-16x16.png?hash=4f3ec2ea83" rel="icon" type="image/png" sizes="16x16"><link href="/img/favicon/site.webmanifest?hash=df884c5d9d" rel="manifest"><link href="/img/favicon/safari-pinned-tab.svg?hash=faeecd6d45" rel="mask-icon" color="#5bbad5"><meta content="#da532c" name="msapplication-TileColor"><link href="/img/favicon/android-chrome-192x192.png?hash=97ce250480" rel="icon" type="image/png"><meta content="#ffe6b7" name="theme-color"><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name="robots"><title>How to fix stale React useState's state in a callback | Dmitrii Dushkin blog</title><meta content="How to fix stale React useState's state in a callback" property="og:title"><meta content="Simple and useful JS snippet" name="description"><meta content="Simple and useful JS snippet" property="og:description"><meta content="summary_large_image" name="twitter:card"><meta content="@sky2high0" name="twitter:site"><meta content="@sky2high0" name="twitter:creator"><meta content="https://dushkin.tech/img/for_posts/react_stale/react_stale_cover.jpg" property="og:image"><link href="https://dushkin.tech/posts/stale_state_react/" rel="canonical"><meta content="no-referrer-when-downgrade" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Dmitrii's tech blog"><link href="/" rel="preconnect" crossorigin=""><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,500;0,700;1,500;1,700&amp;display=swap" rel="stylesheet"><script async="" src="/js/min.js?hash=e9bb8a8457" defer=""></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BJQNRSC76D"></script><script csp-hash="sha256-TVz+2vN3+ZgiiRPB9uCg0Ay6n/8PgEf0tWGg3Bcy+DU=">window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-BJQNRSC76D');</script><script csp-hash="sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>.token.comment{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.tag{color:#e2777a}.token.boolean,.token.function{color:#f08d49}.token.class-name,.token.property{color:#f8c555}.token.keyword{color:#cc99cd}.token.attr-value,.token.string{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.inserted{color:green}header{text-align:center;display:flex;align-items:center;flex-direction:column}header nav{padding:.375em 0;align-self:flex-start;display:flex;gap:16px}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{font-weight:700;text-decoration:none}.pill{display:inline-block;background-color:var(--background-alt);color:var(--text-muted);border-radius:12px;padding:4px 8px;margin:4px 4px 0 0}:root{--background-body:#fffff6;--background:#efefef;--background-alt:#f7f7f7;--selection:#9e9e9e;--text-main:#363636;--text-bright:#000;--text-muted:#63686d;--links:#0076d1;--border:#dbdbdb;--code:#000}@media (prefers-color-scheme:dark){:root{--background-body:#202b38;--background:#161f27;--background-alt:#1a242f;--selection:#1c76c5;--text-main:#dbdbdb;--text-bright:#fff;--text-muted:#a9b1ba;--links:#41adff;--border:#526980;--code:#ffbe85}}html{scrollbar-width:thin;font-family:"Nunito",sans-serif;font-size:17px}body{max-width:800px;margin:20px auto;padding:0 10px;word-wrap:break-word;color:#363636;color:var(--text-main);background:#fff;background:var(--background-body);text-rendering:optimizeLegibility}@media (prefers-color-scheme:dark){body{background:#202b38;background:var(--background-body);color:#dbdbdb;color:var(--text-main)}}h1{font-size:2.2em}h1,h2{margin-bottom:12px;margin-top:24px}code,h1,h2,strong{color:#000;color:var(--text-bright)}@media (prefers-color-scheme:dark){h1{color:#fff;color:var(--text-bright)}}@media (prefers-color-scheme:dark){h2{color:#fff;color:var(--text-bright)}}@media (prefers-color-scheme:dark){strong{color:#fff;color:var(--text-bright)}}b,h1,h2,strong{font-weight:600}a>code,a>strong{color:inherit}a{text-decoration:none;color:#0076d1;color:var(--links)}@media (prefers-color-scheme:dark){a{color:#41adff;color:var(--links)}}a:hover{text-decoration:underline}code{background:#efefef;background:var(--background);color:var(--code);padding:2.5px 5px;border-radius:6px;font-size:1em}@media (prefers-color-scheme:dark){code{color:#ffbe85;color:var(--code);background:#161f27;background:var(--background)}}pre>code{padding:10px;display:block;overflow-x:auto}img{max-width:100%;height:auto;border-radius:8px}::-moz-selection{background-color:#9e9e9e;background-color:var(--selection);color:#000;color:var(--text-bright)}::selection{background-color:#9e9e9e;background-color:var(--selection);color:#000;color:var(--text-bright)}@media (prefers-color-scheme:dark){::-moz-selection{color:#fff;color:var(--text-bright)}::selection{color:#fff;color:var(--text-bright)}::-moz-selection{background-color:#1c76c5;background-color:var(--selection)}::selection{background-color:#1c76c5;background-color:var(--selection)}}footer{border-top:1px solid #dbdbdb;border-top:1px solid var(--border);padding-top:10px;color:#70777f;color:var(--text-muted)}@media (prefers-color-scheme:dark){footer{color:#a9b1ba;color:var(--text-muted);border-top:1px solid #526980;border-top:1px solid var(--border)}}body>footer{margin-top:40px}article{max-width:70ch;margin:auto}aside{font-style:italic}@media (prefers-color-scheme:dark){img{filter:brightness(80%);box-shadow:inset 0 0 85px rgba(0,0,0,.4)}}p{margin:1em 0 -2px}.cover-image{margin-top:1rem;width:100%;max-height:45vh;object-fit:cover}main img{content-visibility:auto}share-widget{position:fixed;right:20px;bottom:20px;opacity:.9}share-widget div{width:30px;height:30px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}</style></head><body><header><nav><h1><a href="/" title="Home">Dmitrii's tech blog</a></h1><a href="/about/">About me</a></nav><h1>How to fix stale React useState's state in a callback</h1><aside>3 min read</aside><dialog id="message"></dialog></header><main><article><picture><source class="cover-image" sizes="90vw" srcset="/img/for_posts/react_stale/react_stale_cover-1920w.avif 1920w, /img/for_posts/react_stale/react_stale_cover-1280w.avif 1280w, /img/for_posts/react_stale/react_stale_cover-640w.avif 640w, /img/for_posts/react_stale/react_stale_cover-320w.avif 320w" type="image/avif"><source class="cover-image" sizes="90vw" srcset="/img/for_posts/react_stale/react_stale_cover-1920w.webp 1920w, /img/for_posts/react_stale/react_stale_cover-1280w.webp 1280w, /img/for_posts/react_stale/react_stale_cover-640w.webp 640w, /img/for_posts/react_stale/react_stale_cover-320w.webp 320w" type="image/webp"><source class="cover-image" sizes="90vw" srcset="/img/for_posts/react_stale/react_stale_cover-1920w.jpg 1920w, /img/for_posts/react_stale/react_stale_cover-1280w.jpg 1280w, /img/for_posts/react_stale/react_stale_cover-640w.jpg 640w, /img/for_posts/react_stale/react_stale_cover-320w.jpg 320w" type="image/jpeg"><img class="cover-image" decoding="async" height="1024" loading="lazy" src="/img/for_posts/react_stale/react_stale_cover-1920w.jpg" style="background-size:cover;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1792 1024'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVR4nAG6AEX/AHnB7HzA6Y/C43qUuIh/m3iWun+23Hu/6XrB7HrB7QB+x/B8wuqAiKe7f4baqKKWdoV3epl8wup9yPF9x+8Afcz0hMrse5Kwk6e/m8fZd4iod4ekgsjqfc30fczzAH3R94TM7H2etYF2j5x7kHVui3eVroXF433Q+H7P9QB+0feI1O18lqddZoVhb45WXn6IhZWKyeF/0/l+0PYAftP4fMrvhcXcjcLTe520ibnMir3Ufcnsf9P4fdH2Lfp3iNdOGDsAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&quot;)" width="1792"></picture><h2 id="problem-statement">Problem statement <a href="#problem-statement" class="direct-link">#</a></h2><p>React components often use functions as prop values, known as "callback functions", to handle events like clicks or modal state changes. However, issues arise with some component libraries (like "react-materialize") which may incorrectly cache these functions and never update it on following re-renders. So when the time comes to call this callback function (e.g. on a button click), it will <strong>use the initial function value</strong>.</p><p>If an initial function doesn't hold any state in its closure, it's not a big problem. But if it does, you may face a <strong>stale state</strong> issue like Matt in <a href="https://stackoverflow.com/questions/73697416/react-stale-usestate-value-in-closure-how-to-fix/77282546#77282546">this StackOverflow question</a>. I also faced the issue using one of internal library components in my project which was also a modal component. I guess it happens due to usage of react's utils for creating modals (mainly <code>createPortal</code> API) which is <a href="https://github.com/react-materialize/react-materialize/blob/d36a4ddad2781e1eb206007c5b615033c5c1c5d5/src/Modal.js#L89">the case</a> for <code>react-materialise</code> Modal component.</p><p>The leading response on StackOverflow is correct, but there is a room for improvement which I outlined in <a href="https://stackoverflow.com/a/77282546/297939">my response</a> and will unfold a bit more in this blog post.</p><h2 id="example-of-the-issue">Example of the issue <a href="#example-of-the-issue" class="direct-link">#</a></h2><p>Let's take as an example a code similar to the StackOverflow question:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>isOpen<span class="token punctuation">,</span> setIsOpen<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"State's value on render ="</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// This function is created each time on every re-render</span><br>  <span class="token comment">// So it holds a correct state value</span><br>  <span class="token keyword">const</span> <span class="token function function-variable">callbackFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"State value inside callbackFn ="</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">setIsOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> modalOptions <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">onCloseStart</span><span class="token operator">:</span> callbackFn<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setIsOpen</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Show modal</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>      </span><span class="token punctuation">{</span><span class="token comment">/**<br>          Modal component from react-materialize<br>          We defined a callback which will be fired on modal close.<br>          `options` is an object which is also created fresh on each re-render.<br>          (!) But due to aggressive caching in Modal component,<br>          it will use initial value of `options` prop each re-render,<br>          so `onCloseStart` will have a "stale" value of `callbackFn`<br>      */</span><span class="token punctuation">}</span><span class="token plain-text"><br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Modal</span></span> <span class="token attr-name">open</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span>isOpen<span class="token punctuation">}</span></span> <span class="token attr-name">options</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span>modalOptions<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">"new value"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>          Update state's value<br>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setIsOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hide modal</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Modal</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="solution">Solution <a href="#solution" class="direct-link">#</a></h2><p>To address the stale state within <code>callbackFn</code>, we utilize <code>useRef</code> to keep the latest function value, ensuring it remains updated across re-renders. Essentially, we will create a stable container (object) with <code>current</code> property and we will update <code>current</code> property on each re-render with a fresh instance of <code>callbackFn</code>:</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>isOpen<span class="token punctuation">,</span> setIsOpen<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> <span class="token function function-variable">callbackFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"In callback state ="</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">setIsOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> callbackRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>callbackFn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- the new line</span><br>  callbackRef<span class="token punctuation">.</span>current <span class="token operator">=</span> callbackFn<span class="token punctuation">;</span> <span class="token comment">// &lt;-- the new line. Store the latest callbackFn on each re-render</span><br><br>  <span class="token keyword">const</span> modalOptions <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">onCloseStart</span><span class="token operator">:</span> callbackRef<span class="token punctuation">.</span>current<span class="token punctuation">,</span> <span class="token comment">// &lt;-- updated line</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setIsOpen</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Show modal</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Modal</span></span> <span class="token attr-name">open</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span>isOpen<span class="token punctuation">}</span></span> <span class="token attr-name">options</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span>modalOptions<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Set state</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span><br>          <span class="token attr-name">onClick</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>            <span class="token function">setIsOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"state on hide click ="</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><span class="token punctuation">}</span></span><br>        <span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>          Hide modal<br>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Modal</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"><br>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Here is you can find a <a href="https://codesandbox.io/p/sandbox/react-stale-usestate-value-in-closure-how-to-fix-forked-tnj6x2">working example</a> on CodeSandbox.</p><div style="margin-top: 24px"><a href="/tags/react/" class="pill">#react</a> <a href="/tags/javascript/" class="pill">#javascript</a> <a href="/tags/typescript/" class="pill">#typescript</a></div><h1>***</h1><p>Since you've made it this far, <a href="https://dushkin.tech/posts/stale_state_react/" on-click="share">sharing</a> this article on your favorite social media network would be highly appreciated 💖! For feedback, please <a href="https://twitter.com/sky2high0" rel="noopener" target="_blank">ping me on Twitter</a>.</p><share-widget><button aria-label="Share" href="https://dushkin.tech/posts/stale_state_react/" on-click="share"><div></div></button></share-widget><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"How to fix stale React useState&#39;s state in a callback","image":["https://dushkin.tech/img/for_posts/react_stale/react_stale_cover-1920w.jpg"],"author":"Dmitrii Dushkin","genre":"software development","publisher":{"@type":"Organization","name":"Dmitrii Dushkin","logo":{"@type":"ImageObject","url":"/img/favicon/android-chrome-192x192.png?hash=97ce250480"}},"url":"https://dushkin.tech/posts/stale_state_react/","mainEntityOfPage":"https://dushkin.tech/posts/stale_state_react/","datePublished":"2024-04-04","dateModified":"2024-04-04","description":"Problem statement # React components often use functions as prop values, known as &amp;quot;callback functions&amp;quot;, to handle events like..."}</script><p>Published <time datetime="2024-04-04">04 Apr 2024</time></p></article></main><footer><a href="/about/">Dmitrii Dushkin</a></footer></body></html>