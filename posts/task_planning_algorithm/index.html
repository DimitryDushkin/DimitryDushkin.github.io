<!DOCTYPE html><html domain="dushkin.tech" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><link href="/img/favicon/apple-touch-icon.png?hash=59d9e0e5b0" rel="apple-touch-icon" sizes="180x180"><link href="/img/favicon/favicon-32x32.png?hash=3efd12fae9" rel="icon" type="image/png" sizes="32x32"><link href="/img/favicon/favicon-16x16.png?hash=c62836a972" rel="icon" type="image/png" sizes="16x16"><link href="/img/favicon/site.webmanifest?hash=df884c5d9d" rel="manifest"><link href="/img/favicon/safari-pinned-tab.svg?hash=faeecd6d45" rel="mask-icon" color="#5bbad5"><meta content="#da532c" name="msapplication-TileColor"><link href="/img/favicon/android-chrome-192x192.png?hash=b5d5df46f5" rel="icon" type="image/png"><meta content="#ffe6b7" name="theme-color"><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name="robots"><title>Task planning algorithm in TypeScript: real-life problem solved with a graph theory | Dmitrii Dushkin blog</title><meta content="Task planning algorithm in TypeScript: real-life problem solved with a graph theory" property="og:title"><meta content="In this article, I’ll present the algorithm which helps to answer the main question of all project planning efforts: When will it be done? A more formal representation of this problem sounds like: “Having some tasks which might depend on each other and some folks which can do those tasks when a milestone can be reached?”" name="description"><meta content="In this article, I’ll present the algorithm which helps to answer the main question of all project planning efforts: When will it be done? A more formal representation of this problem sounds like: “Having some tasks which might depend on each other and some folks which can do those tasks when a milestone can be reached?”" property="og:description"><meta content="summary_large_image" name="twitter:card"><meta content="@sky2high0" name="twitter:site"><meta content="@sky2high0" name="twitter:creator"><meta content="https://dushkin.tech/img/for_posts/task_planning/cover.jpeg" property="og:image"><link href="https://dushkin.tech/posts/task_planning_algorithm/" rel="canonical"><meta content="no-referrer-when-downgrade" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Dmitrii's tech blog"><link href="/" rel="preconnect" crossorigin=""><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,500;0,700;1,500;1,700&amp;display=swap" rel="stylesheet"><script async="" src="/js/min.js?hash=e9bb8a8457" defer=""></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BJQNRSC76D"></script><script csp-hash="sha256-TVz+2vN3+ZgiiRPB9uCg0Ay6n/8PgEf0tWGg3Bcy+DU=">window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-BJQNRSC76D');</script><script csp-hash="sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>.token.comment{color:#999}.token.punctuation{color:#ccc}.token.tag{color:#e2777a}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property{color:#f8c555}.token.builtin,.token.important,.token.keyword{color:#cc99cd}.token.string{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.important,header nav a{font-weight:700}.token.inserted{color:green}header{text-align:center;display:flex;align-items:center;flex-direction:column}header nav{padding:.375em 0;align-self:flex-start;display:flex;gap:16px}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{text-decoration:none}.tag{display:inline-block;background-color:var(--background-alt);color:var(--text-muted);border-radius:12px;padding:4px 8px;margin:4px 4px 0 0}:root{--background-body: #fffff6;--background: #efefef;--background-alt: #f7f7f7;--selection: #9e9e9e;--text-main: #363636;--text-bright: #000;--text-muted: #63686d;--links: #0076d1;--focus: #0096bfab;--border: #dbdbdb;--code: #000}@media (prefers-color-scheme:dark){:root{--background-body: #202b38;--background: #161f27;--background-alt: #1a242f;--selection: #1c76c5;--text-main: #dbdbdb;--text-bright: #fff;--text-muted: #a9b1ba;--links: #41adff;--focus: #0096bfab;--border: #526980;--code: #ffbe85;--animation-duration: 0.1s;--button-base: #0c151c;--button-hover: #040a0f;--form-placeholder: #a9a9a9;--form-text: #fff;--variable: #d941e2;--highlight: #efdb43}}html{scrollbar-width:thin;font-family:"Nunito",sans-serif;font-size:17px}body{max-width:800px;margin:20px auto;padding:0 10px;word-wrap:break-word;color:#363636;color:var(--text-main);background:#fff;background:var(--background-body);text-rendering:optimizeLegibility}@media (prefers-color-scheme:dark){body{background:#202b38;background:var(--background-body);color:#dbdbdb;color:var(--text-main)}}h1{font-size:2.2em;margin-bottom:12px;margin-top:24px;color:#000;color:var(--text-bright)}@media (prefers-color-scheme:dark){h1{color:#fff;color:var(--text-bright)}}code,strong{color:#000;color:var(--text-bright)}@media (prefers-color-scheme:dark){strong{color:#fff;color:var(--text-bright)}}b,h1,strong{font-weight:600}blockquote{border-left:4px solid #0096bfab;border-left:4px solid var(--focus);margin:1.5em 0;padding:.5em 1em;font-style:italic}@media (prefers-color-scheme:dark){blockquote{border-left:4px solid #0096bfab;border-left:4px solid var(--focus)}}blockquote>footer{font-style:normal;border:0}a>code,a>strong{color:inherit}a{text-decoration:none;color:#0076d1;color:var(--links)}@media (prefers-color-scheme:dark){a{color:#41adff;color:var(--links)}}a:hover{text-decoration:underline}code{background:#efefef;background:var(--background);color:var(--code);padding:2.5px 5px;border-radius:6px;font-size:1em}@media (prefers-color-scheme:dark){code{color:#ffbe85;color:var(--code);background:#161f27;background:var(--background)}}pre>code{padding:10px;display:block;overflow-x:auto}img{max-width:100%;height:auto;border-radius:8px}::selection{background-color:#9e9e9e;background-color:var(--selection);color:#000;color:var(--text-bright)}@media (prefers-color-scheme:dark){::selection{color:#fff;color:var(--text-bright);background-color:#1c76c5;background-color:var(--selection)}}footer{border-top:1px solid #dbdbdb;border-top:1px solid var(--border);padding-top:10px;color:#70777f;color:var(--text-muted)}@media (prefers-color-scheme:dark){footer{color:#a9b1ba;color:var(--text-muted);border-top:1px solid #526980;border-top:1px solid var(--border)}}body>footer{margin-top:40px}article{max-width:70ch;margin:auto}aside{font-style:italic}@media (prefers-color-scheme:dark){img{filter:brightness(80%);box-shadow:inset 0 0 85px rgba(0,0,0,.4)}}ol,ul{margin:.8rem 0 1.1rem;padding:0 0 0 1.5em}li>ul{margin-top:.5rem}li:not(:last-child){margin-bottom:.3rem}p{margin:1em 0 -2px}.cover-image{margin-top:1rem;width:100%;max-height:45vh;object-fit:cover}main img{content-visibility:auto}share-widget{position:fixed;right:20px;bottom:20px;opacity:.9}share-widget div{width:30px;height:30px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}</style></head><body><header><nav><h1><a href="/" title="Home">Dmitrii's tech blog</a></h1><a href="/about/">About me</a></nav><h1>Task planning algorithm in TypeScript: real-life problem solved with a graph theory</h1><aside>8 min read</aside><dialog id="message"></dialog></header><main><article><img src="/img/for_posts/task_planning/cover.jpeg" class="cover-image"><p>In this article, I’ll present the algorithm which helps to answer the main question of all project planning efforts:</p><blockquote><p>When will it be done?</p></blockquote><p>A more formal representation of this problem sounds like: “Having some tasks which might depend on each other and some folks which can do those tasks when a milestone can be reached?”</p><p>Weekly sprint planning meeting in essence</p><h1 id="a-little-backstory">A Little Backstory <a href="#a-little-backstory" class="direct-link">#</a></h1><p>In 2019-2021 I work as a tech lead. I was responsible for 3 different projects with a team of 11 developers, 2 managers, 2 designers, and several departments to cooperate with.</p><p>For task tracking, we’re using our internal tool <a href="https://yandex.ru/tracker/">Yandex Tracker</a> which is mostly like Jira. But it has no tools that’ll help to find the answer for an eternal question: “When?”. That’s why from time to time we manually sync tasks with <strong>Omniplan</strong>. Turned out that it’s the tool that solves almost all project planning problems and moreover it has an <strong>auto-planning feature</strong> so all situations when one assignee has workload over 100% are resolved automatically.</p><p>Still, it has some drawbacks:</p><ul><li>Slow and unreliable project sync between team mates based on a local copy syncing</li><li>MacOS only</li><li>Quite hard to sync it with our issue tracker</li><li>Pricey: $200 and $400 for Pro edition</li></ul><p>So I’ve decided to try to make my own Omniplan version with blackjack and hookers that would be:</p><ul><li>Web-based</li><li>Simple syncing with our tracker</li><li>With real-time collaboration</li></ul><p>The most exciting part was to make <strong>a scheduling engine</strong>. I didn’t understand why only Omniplan has such an essential feature. Now I do.</p><p>So this article is about scheduling.</p><h1 id="developing-a-scheduling-engine">Developing a scheduling engine <a href="#developing-a-scheduling-engine" class="direct-link">#</a></h1><p>First I’ve done some research. I’ve googled for solving scheduling tasks in general and found a lot of about <a href="https://en.wikipedia.org/wiki/Gantt_chart">Gantt</a>, <a href="https://en.wikipedia.org/wiki/Program_evaluation_and_review_technique">PERT</a>, but haven’t found any practical algorithms.</p><p>Then I looked for open-source libraries and found only one: <a href="https://github.com/bryntum/chronograph">Bryntum Chronograph</a>. It seems like something I was looking for all the time. They even have <a href="https://github.com/bryntum/scheduler-performance">benchmarks</a>. But, well, talking honestly I didn’t understand <a href="https://github.com/bryntum/chronograph/blob/master/src/chrono/Graph.ts">any of its code</a> and almost complete lack of documentation didn’t help either. I thought maybe, what if I could write it from scratch with less code.</p><p>So, as usual, I’ve tried to draw the problem.</p><p><img src="/img/for_posts/task_planning/1.png" alt="Timeline of tasks before scheduling"><br><em>Timeline of tasks before scheduling</em></p><p>While drawing it I’ve probably got the most important insight: tasks can be represented as a directed graph and edges are not only the explicit dependencies but also <em>implicit dependencies by the same assignee</em>.</p><p>The following algorithm should lead to such tasks arrangement:</p><p><img src="/img/for_posts/task_planning/2.png" alt="Timeline of tasks after scheduling"><br><em>Timeline of tasks after scheduling</em></p><p>Let’s consider what a task is:</p><p><img src="/img/for_posts/task_planning/3.png" alt="Task anatomy"><br><em>Task anatomy</em></p><p>There are some not so obvious properties of a task:</p><ul><li><strong>Duration</strong>. The task is being done only during <em>business</em> days and the number of <em>business</em> days is an <em>estimation</em> of a task. So in this example the task starts on 2 March, has an estimation of 6 days, so it will end on 9 March (<em>not 7 March</em>), because 7 and 8 March are holidays.</li><li><strong>Position</strong>. In this model, we assume that tasks with lower positions (same as a higher priority) should be done earlier than a task with higher positions (or lower priority).</li><li><strong>Progress</strong>. It is a portion of a task that can be represented in percents but in fact, it is a number of days that were spent on a task. For example, if a task is estimated up to 4 days and, then progress is 75%, that 1 day left to task completion.</li></ul><p>So TypeScript type is as follows (<em>ID is just an alias for string</em>):</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">Task</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  id<span class="token operator">:</span> <span class="token constant">ID</span><span class="token punctuation">;</span><br>  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  start<span class="token operator">:</span> Date<span class="token punctuation">;</span><br>  end<span class="token operator">:</span> Date<span class="token punctuation">;</span><br>  duration<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/**<br>   * Approximation of priority<br>   */</span><br>  position<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><br>  progress<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><br>  resourceId<span class="token operator">:</span> <span class="token constant">ID</span><span class="token punctuation">;</span><br>  <span class="token comment">/**<br>   * Current task blocked by these tasks (depends on)<br>   */</span><br>  blockedBy<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token constant">ID</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h1 id="the-algorithm">The algorithm <a href="#the-algorithm" class="direct-link">#</a></h1><p>In essence, the algorithm should change start and end dates of the tasks in the following way:</p><ol><li>Tasks should start today if it is possible</li><li>It should be impossible to start a task today if it has other tasks as prerequisites that are unfinished. In that case, a task should start right after the last prerequisite’s end date.</li></ol><p>Pretty simple, huh? 🙈</p><p>The main steps of the algorithm are:</p><ol><li><strong>Build a graph from tasks.</strong> Make edges taking into account explicit dependencies and implicit dependencies by the same assignee.</li></ol><pre class="language-typescript"><code class="language-typescript"><span class="token comment">/**<br> * Graph respects explicit dependencies<br> * and implicit by resources (via positions)<br> */</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> makeGraphFromTasks <span class="token operator">=</span> <span class="token punctuation">(</span>tasks<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Task<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> Graph <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token comment">// task and blockedBy</span><br>  <span class="token keyword">const</span> graph<span class="token operator">:</span> Graph <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> resourcesTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token constant">ID</span><span class="token punctuation">,</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Task<span class="token operator">&gt;&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Create graphs</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> t <span class="token keyword">of</span> tasks<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// resource and its tasks</span><br>    <span class="token keyword">const</span> tasksOfResource <span class="token operator">=</span> resourcesTasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>resourceId<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    tasksOfResource<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    resourcesTasks<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>resourceId<span class="token punctuation">,</span> tasksOfResource<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    graph<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>blockedBy <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Now add deps</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> tasksOfResource <span class="token keyword">of</span> resourcesTasks<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// first sort by position so links of tasks starts with higher position</span><br>    <span class="token comment">// then topological sort to reduce cyclic deps</span><br>    tasksOfResource<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>position <span class="token operator">-</span> b<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// is toposort needed?</span><br>    <span class="token keyword">const</span> sortedTasks <span class="token operator">=</span> <span class="token function">toposort</span><span class="token punctuation">(</span>graph<span class="token punctuation">,</span> tasksOfResource<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// add to graph such edges so current node has prev as dependency (blocked by prev)</span><br>    <span class="token keyword">let</span> prevTask<span class="token operator">:</span> Task <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> task <span class="token keyword">of</span> sortedTasks<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span><br>        prevTask <span class="token operator">&amp;&amp;</span><br>        prevTask<span class="token punctuation">.</span>id <span class="token operator">!==</span> task<span class="token punctuation">.</span>id <span class="token operator">&amp;&amp;</span><br>        <span class="token comment">// has no incoming edge as well (otherwise it will be cyclic dep)</span><br>        <span class="token operator">!</span>graph<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>prevTask<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">has</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>id<span class="token punctuation">)</span><br>      <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        graph<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">add</span><span class="token punctuation">(</span>prevTask<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>      prevTask <span class="token operator">=</span> task<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> graph<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><strong>2.Remove circular dependencies.</strong> If cycles are present throw an error because that means that some task A has as prerequisite task B and task B has as prerequisite task A, which is a classic problem of <a href="https://en.wikipedia.org/wiki/Circular_dependency">circular dependency</a> and the problem should be resolved manually. Tasks A and B do not necessarily have an explicit dependency on each other, there are might some other tasks between them.</p><pre class="language-typescript"><code class="language-typescript"><span class="token comment">/**<br> * Main source of cyclic dependencies is previous step where graph is created<br> * Often top-level task has same owner as children tasks<br> * Since we create edge in graph also by same owner that's why there is cyclic deps<br> *<br> * IDEA: mitigate the issue by starting DFS walk from top-level (source) tasks!<br> */</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> removeCyclicDependencies <span class="token operator">=</span> <span class="token punctuation">(</span><br>  graph<span class="token operator">:</span> Graph<span class="token punctuation">,</span><br>  tasks<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Task<span class="token operator">&gt;</span><br><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Track visited to avoid computing path for already computed nodes</span><br>  <span class="token keyword">const</span> visited <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> cyclicDepsRemovedCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> <span class="token function function-variable">dfsAndRemove</span> <span class="token operator">=</span> <span class="token punctuation">(</span>rootTaskId<span class="token operator">:</span> <span class="token constant">ID</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>    <span class="token comment">// [current task ID, set of previously visited tasks]</span><br>    <span class="token keyword">const</span> stack<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token constant">ID</span><span class="token punctuation">,</span> Set<span class="token operator">&lt;</span><span class="token constant">ID</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>rootTaskId<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> nextValue <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">nullthrows</span><span class="token punctuation">(</span>nextValue<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> <span class="token punctuation">[</span>taskId<span class="token punctuation">,</span> prevSet<span class="token punctuation">]</span> <span class="token operator">=</span> nextValue<span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> blockedBy <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      visited<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> blockedById <span class="token keyword">of</span> blockedBy<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// cycle detected!</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>prevSet<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>blockedById<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token comment">// remove that edge</span><br>          blockedBy<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>blockedById<span class="token punctuation">)</span><span class="token punctuation">;</span><br>          cyclicDepsRemovedCount<span class="token operator">++</span><span class="token punctuation">;</span><br>          <span class="token keyword">continue</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token keyword">const</span> newPrevSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>prevSet<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        newPrevSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>blockedById<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>blockedById<span class="token punctuation">,</span> newPrevSet<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> task <span class="token keyword">of</span> tasks<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>visited<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">continue</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token function">dfsAndRemove</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Cyclic deps removed:"</span><span class="token punctuation">,</span> cyclicDepsRemovedCount<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><strong>3. Visit every node (task) and update a start and end dates.</strong> Visiting should be performed starting from the task with higher priority</p><p>If a task is a source (it is not a prerequisite for any other task and task’s assignee has no other task to do before this task) or a task is disconnected node (it has no dependencies and it is not prerequisite for any other tasks) then we start task today.</p><p>Otherwise, a task has prerequisites and its start date should be set to the latest end date of its prerequisites tasks.</p><p>Also, it is important to correctly <strong>update an end date while setting a start date of a task</strong>. We should take into account actual business days and the progress of a task.</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> scheduleTasks <span class="token operator">=</span> <span class="token punctuation">(</span><br>  inputTasks<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Task<span class="token operator">&gt;</span><span class="token punctuation">,</span><br>  today<span class="token operator">:</span> Date <span class="token operator">=</span> <span class="token function">getNowDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Task<span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> dayBeforeToday <span class="token operator">=</span> <span class="token function">subtractDays</span><span class="token punctuation">(</span>today<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> tasks<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Task<span class="token operator">&gt;</span> <span class="token operator">=</span> inputTasks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>t <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> tasksById<span class="token operator">:</span> TasksById <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>tasks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>t<span class="token punctuation">.</span>id<span class="token punctuation">,</span> t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> graph <span class="token operator">=</span> <span class="token function">makeGraphFromTasks</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> cyclesToFullyUpdateDates <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 1. Remove cyclic dependencies</span><br>  <span class="token function">removeCyclicDependencies</span><span class="token punctuation">(</span>graph<span class="token punctuation">,</span> tasks<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 2. Initial update of all tasks start and ends days taking into account business days</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> task <span class="token keyword">of</span> tasks<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">updateTaskDatesByStart</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> today<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Repeat until dates remains unchanged, max graph.size times.</span><br>  <span class="token comment">// Similar to optimization in Bellman-Ford algorithm</span><br>  <span class="token comment">// @see https://en.wikipedia.org/wiki/Bellman–Ford_algorithm#Improvements</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tasks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> isAnyTaskTimelineChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>taskId<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token function">dfs</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> task <span class="token operator">=</span> tasksById<span class="token punctuation">[</span>taskId<span class="token punctuation">]</span><span class="token punctuation">;</span><br>      <span class="token comment">// if blockedBy task not in initial data set</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">continue</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>      <span class="token keyword">const</span> blockedByTasks <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>graph<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>blockedById<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> tasksById<span class="token punctuation">[</span>blockedById<span class="token punctuation">]</span><span class="token punctuation">)</span><br>        <span class="token comment">// do not take into account tasks not in graph</span><br>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> blockedByEndDates <span class="token operator">=</span> blockedByTasks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// add dayBeforeToday by default, so task without blockedBy starts on today</span><br>      blockedByEndDates<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dayBeforeToday<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token comment">// Start task on the next day after previous (blockedBy) tasks ends</span><br>      <span class="token keyword">const</span> maxBlockedByEndDate <span class="token operator">=</span> <span class="token function">addDays</span><span class="token punctuation">(</span><span class="token function">maxDateTime</span><span class="token punctuation">(</span>blockedByEndDates<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> isTaskTimelineUpdated <span class="token operator">=</span> <span class="token function">updateTaskDatesByStart</span><span class="token punctuation">(</span><br>        task<span class="token punctuation">,</span><br>        maxBlockedByEndDate<br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>isTaskTimelineUpdated<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        isAnyTaskTimelineChanged <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isAnyTaskTimelineChanged <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">break</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    cyclesToFullyUpdateDates<span class="token operator">++</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isAnyTaskTimelineChanged <span class="token operator">&amp;&amp;</span> i <span class="token operator">===</span> tasks<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><br>        <span class="token string">'It\'s not enought "tasks.length" interations to fully schedule all tasks!'</span><br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><br>    <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">Cycles to fully update dates </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>cyclesToFullyUpdateDates<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>tasks<span class="token punctuation">.</span>length<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string template-punctuation">`</span></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// for better representation</span><br>  <span class="token keyword">return</span> <span class="token function">toposort</span><span class="token punctuation">(</span>graph<span class="token punctuation">,</span> tasks<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h1 id="what-can-be-improved">What can be improved <a href="#what-can-be-improved" class="direct-link">#</a></h1><ol><li>Probably the most important feature which leads to a more complex solution is introducing <strong>a desirable start date</strong> of a task. I didn’t research it yet, but if someday it will grow to a standalone web-service I think it should be done. Now, this feature can be mitigated by setting proper priorities of tasks.</li><li>For the enterprise-grade solution, it is important to take into account vacations and public holidays. I think <strong>updateStartDate</strong> function can be quite easily updated to support this functionality.</li><li>For my case having a <strong>day</strong> as a time quant was okay, but I believe for some people <strong>hour</strong>-based planning might be important. I think implementing an hour-based quant can also introduce some complications to code.</li></ol><h1 id="conclusion">Conclusion <a href="#conclusion" class="direct-link">#</a></h1><p>The code from the article you can find <a href="https://github.com/DimitryDushkin/project-tasks-scheduling-engine">here</a>. You can grab and use it as an <a href="https://www.npmjs.com/package/project-tasks-scheduling-engine">NPM package</a>.</p><p>I’m wondering if a presented solution has some flaws. If you spotted some please contact me here or on <a href="https://github.com/DimitryDushkin/project-tasks-scheduling-engine/issues">issues section in Github</a>.</p><div style="margin-top: 24px"><a href="/tags/task-planning/" class="tag">#task planning</a> <a href="/tags/algorithms/" class="tag">#algorithms</a> <a href="/tags/typescript/" class="tag">#typescript</a></div><h1>***</h1><p>Since you've made it this far, <a href="https://dushkin.tech/posts/task_planning_algorithm/" on-click="share">sharing</a> this article on your favorite social media network would be highly appreciated 💖! For feedback, please <a href="https://twitter.com/sky2high0" rel="noopener" target="_blank">ping me on Twitter</a>.</p><share-widget><button aria-label="Share" href="https://dushkin.tech/posts/task_planning_algorithm/" on-click="share"><div></div></button></share-widget><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Task planning algorithm in TypeScript: real-life problem solved with a graph theory","image":["https://dushkin.tech/img/for_posts/task_planning/cover.jpeg","https://dushkin.tech/img/for_posts/task_planning/1.png","https://dushkin.tech/img/for_posts/task_planning/2.png","https://dushkin.tech/img/for_posts/task_planning/3.png"],"author":"Dmitrii Dushkin","genre":"software development","publisher":{"@type":"Organization","name":"Dmitrii Dushkin","logo":{"@type":"ImageObject","url":"/img/favicon/android-chrome-192x192.png?hash=b5d5df46f5"}},"url":"https://dushkin.tech/posts/task_planning_algorithm/","mainEntityOfPage":"https://dushkin.tech/posts/task_planning_algorithm/","datePublished":"2022-11-15","dateModified":"2023-10-21","description":"In this article, I’ll present the algorithm which helps to answer the main question of all project planning efforts: When will it be done? A..."}</script><p>Published <time datetime="2022-11-15">15 Nov 2022</time></p></article></main><footer><a href="/about/">Dmitrii Dushkin</a></footer></body></html>